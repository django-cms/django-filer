{% extends "admin/filer/base_site.html" %}
{% load i18n staticfiles filer_admin_tags %}

{% block extrahead %}
    {{ block.super }}

    {% if action_form and actions_on_top or actions_on_bottom %}
        <script type="text/javascript">
            (function($) {
                $(document).ready(function($) {
                    $('tr input.action-select').actions();
                });
            })(django.jQuery);
        </script>
    {% endif %}
{% endblock %}

{% block coltype %}{% endblock %}
{% block bodyclass %}change-list filebrowser{% endblock %}


{% block extrastyle %}
    {{ block.super }}

    {{ media.css }}
    {% if action_form %}
        {% url 'admin:jsi18n' as jsi18nurl %}
        <script type="text/javascript" src="{{ jsi18nurl|default:'../../jsi18n/' }}"></script>
    {% endif %}
    {% if query.pop %}
        <style type="text/css">
            #header {
                display: none;
            }
        </style>
    {% endif %}
{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block sidebar %}{% endblock %}

{% block content_title %}
    <h2>&nbsp;</h2>
{% endblock %}

{% block content %}
    <div class="navigator-top-nav clearfix">
        <div class="breadcrumbs-container">
            {% for ancestor_folder in instance.logical_path %}
                {{ ancestor_folder }}
            {% endfor %}

            {% if not is_popup %}
                <div class="breadcrumbs">
                    <a href="{% url 'admin:index' %}" title="{% trans 'Go back to admin homepage' %}">
                        {% trans "Home" %}
                    </a>
                    &rsaquo;
                    <a href="{% url 'admin:app_list' app_label='filer' %}" title="{% trans 'Go back to Filer app' %}">
                        {% trans "Filer" %}
                    </a>
                    {% if not instance.is_root and instance.is_smart_folder %}
                        &rsaquo;
                        <a href="{% url 'admin:filer-directory_listing-root' %}" title="{% trans 'Go back to root folder' %}">{% trans "root" %}</a>
                    {% endif %}
                    {% for ancestor_folder in instance.logical_path %}
                        &rsaquo;
                        <a href="{{ ancestor_folder.get_admin_directory_listing_url_path }}"
                            title="{% blocktrans with ancestor_folder.name as folder_name %}Go back to '{{ folder_name }}' folder{% endblocktrans %}">
                            {% if ancestor_folder.label %}{{ ancestor_folder.label }}{% else %}{{ ancestor_folder.name }}{% endif %}
                        </a>
                    {% endfor %}
                    {% if breadcrumbs_action %}
                        &rsaquo;
                        <a href="{{ instance.get_admin_directory_listing_url_path }}"
                            title="{% blocktrans with instance.name as folder_name %}Go back to '{{ folder_name }}' folder{% endblocktrans %}">
                            {% if instance.label %}
                                {{ instance.label }}
                            {% else %}
                                {{ instance.name }}
                            {% endif %}
                        </a>
                        &rsaquo;
                        {{ breadcrumbs_action }}
                    {% else %}
                        &rsaquo;
                        {% if instance.label %}
                            {{ instance.label }}
                        {% else %}
                            {{ instance.name }}
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}

            <div class="navigator-breadcrumbs">
                <a href="{% url 'admin:filer-directory_listing-root' %}{% if is_popup %}?_popup=1{% if select_folder %}&amp;select_folder=1{% endif %}{% endif %}"
                    title="{% trans 'Go back to' %} {% trans 'root'|title %} {% trans 'folder' %}">
                    Root
                </a>
                {% if not folder.is_root %}
                    {% if folder.parent.parent %}
                        <span class="icon fa fa-chevron-right"></span>
                        ...
                    {% endif %}

                    {% if folder.parent %}
                        <span class="icon fa fa-chevron-right"></span>
                        <a href="{% url 'admin:filer-directory_listing' folder.parent.id %}{% if is_popup %}?_popup=1{% if select_folder %}&amp;select_folder=1{% endif %}{% endif %}"
                            title="{% trans 'Go back to the parent folder' %}">
                            {{ folder.parent.name }}
                        </a>
                    {% endif %}

                    <span class="icon fa fa-chevron-right"></span>
                    {{ folder.name }}

                    {% if not is_popup and not select_folder and folder.file_type == 'Folder' and permissions.has_edit_permission %}
                        <div class="dropdown-container dropdown-container-down">
                            <a href="#" data-toggle="dropdown" aria-expanded="false">
                                <span class="fa fa-caret-down"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="{% url 'admin:filer_folder_change' folder.id %}" title="{% trans 'Change current folder details' %}">{% trans "Change" %}</a>
                                </li>
                            </ul>
                        </div>
                    {% endif %}
                {% elif folder.is_smart_folder %}
                    <span class="icon fa fa-chevron-right"></span>
                    {{ folder.name }}
                {% endif %}
            </div>
        </div>

        {% block object-tools %}
            <div class="navigator-tools">
                {% if paginated_items.object_list|length and not is_popup %}
                    <span class="separator"></span>
                    <div class="dropdown-container js-actions-menu">
                        <a href="#" data-toggle="dropdown" aria-expanded="false" class="nav-button nav-button-dots">
                            <span class="fa fa-ellipsis-v"></span>
                        </a>
                        <ul class="create-menu-dropdown dropdown-menu">
                            <!-- Actions will go here -->
                        </ul>
                    </div>
                    <span class="separator"></span>
                {% endif %}
                {% block object-tools-items %}
                    <div class="navigator-button-wrapper">
                        {% if folder.can_have_subfolders and can_make_folder %}
                            <a href="{% url 'admin:filer-directory_listing-make_root_folder' %}?parent_id={{ folder.id }}"
                                title="{% trans 'Adds a new Folder' %}"
                                class="navigator-button"
                                onclick="return showAddAnotherPopup(this);">
                            {% trans "New Folder" %}
                            </a>
                        {% endif %}
                        {% if permissions.has_add_children_permission and not folder.is_root %}
                            <a href="#" id="id_upload_button" title="{% trans 'Upload Files' %}" class="navigator-button navigator-button-upload js-upload-button" data-url="{% url 'admin:filer-ajax_upload' folder_id=folder.id %}" data-max-uploader-connections="{{ uploader_connections }}">
                                {% trans "Upload Files" %}
                            </a>
                        {% endif %}
                    </div>
                {% endblock %}
            </div>
        {% endblock %}
    </div>
    <div id="content-main">
        {% include "admin/filer/tools/search_form.html" %}
        <div class="js-navigator navigator{% if not actions_on_top and not actions_on_bottom %}navigator-no-actions{% endif %}">
            <form class="js-navigator-form" method="post">
                {% csrf_token %}
                {% if is_popup %}
                    <input type="hidden" name="_popup" value="1">
                {% endif %}
                {% if action_form and actions_on_top and paginator.count and not select_folder and not is_popup %}
                    {% filer_actions %}
                {% endif %}
                {% include "admin/filer/folder/directory_table.html" %}
                {% if action_form and actions_on_bottom and paginator.count and not select_folder and not is_popup %}
                    {% filer_actions %}
                {% endif %}
            </form>
        </div>
    </div>
{% endblock %}
