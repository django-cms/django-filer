@use "dropdown";
@use "menubar";
@use "sass:meta";
@use "colors";
@use "progress";
@use "labels";
@use "tooltip";

// messagelist appears after saving a file
ul.messagelist {
	position: relative;
	z-index: 1;
	&.fade-out {
		opacity: 1;
		animation: fade-out-animate 1s linear 4s 1;
	}

	@keyframes fade-out-animate {
		100% {
			opacity: 0;
		}
	}
}

.content {
	position: relative;
}

#content {
	padding: 0;
	h1 {
		margin: 10px 20px;
	}
}

#content-start {
	background: var(--darkened-bg);
}

#content-react {
	position: absolute;
	right: 0;
	left: 0;
	bottom: 0;
	padding: 0;
	user-select: none;
	background: var(--darkened-bg);

	&.folder {
		top: 0;
	}
	&.file {
		top: 36px;
	}

	//nav {
		//margin: 4px 0;

		@include menubar.menubar;
	//}

	ul.folder-tabs {
		display: flex;
		flex-wrap: wrap;
		margin: 10px 0 0 0;
		padding: 0 12px;
		border-bottom: 1px solid colors.$border-color;

		li {
			display: list-item;
			list-style: none;
			margin: -5px 2px -1px 2px;
			padding: 6px 14px;
			font-size: 16px;
			font-weight: bold;
			border: 1px solid colors.$border-color;
			border-top-left-radius: 4px;
			border-top-right-radius: 4px;
			border-bottom: 1px solid colors.$body-bg-color;
			background-color: colors.$selected-bg-color;

			&.active, &.current {
				background-color: colors.$body-bg-color;
			}
			&:not(.active) {
				cursor: pointer;
				border-bottom: 1px solid colors.$border-color;
			}
			&.drag-over:not(.active) {
				color: colors.$selected-row-color;
				background-color: var(--button-hover-bg);
			}
			&.trash {
				&.active {
					background-image: colors.$trash-background;
					background-color: transparent;
					background-attachment: fixed;
				}
				margin-left: auto;
			}

			span {
				cursor: pointer;
				margin-left: 5px;
				color: var(--link-fg);
				border-radius: 50%;
				display: inline-block;
				width: 20px;

				&:hover {
					color: var(--link-hover-color);
					background-color: var(--primary);
				}

				> div {
					display: inline-block;
				}

				svg {
					height: 16px;
					width: 16px;
					margin: -2px 2px;
				}
			}

			svg {
				display: inline-block;
				width: 24px;
				height: 24px;
				margin: -6px 0;
			}
		}
	}

	.work-area {
		width: 100%;
		height: calc(100% - 75px);
		overflow: hidden;
		display: flex;
		flex-wrap: nowrap;
		flex-direction: row-reverse;
		justify-content: flex-start;
		align-items: stretch;

		&:not(:has(.inode-list.trash)) {
			background-color: colors.$body-bg-color;
		}

		.column-droppable {
			&.dragging {
				// while dragging, extend the droppable area to the full height of the work-area
				position: absolute;
				inset: 0;
			}

			&.drag-over {
				background-color: var(--primary);

				ul.inode-list > li:nth-child(even) {
					background-color: inherit;
				}
			}
		}

		.status {
			font-size: 18px;
			font-weight: bold;
			line-height: 50px;
			color: var(--body-quiet-color);
			padding-left: 2em;
			width: auto;
		}

		ul.inode-list {
			> li {
				&.dragging .inode, &.cutted .inode {
					outline: 1px dashed grey;
					filter: grayscale(100%);
					opacity: 0.4;
				}

				&.copied .inode {
					border: colors.$copied-inode-border;

					&::after {
						content: " ";
						position: absolute;
						bottom: 5px;
						right: 5px;
						width: 32px;
						height: 32px;
						background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(48, 164, 0)"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z"></path></svg>');
						background-repeat: no-repeat;
					}
				}
			}

			&.trash > li:nth-child(n):not(.selected) {
				background-color: transparent;
			}
		}

		.file-uploader {
			width: 100%;
		}

		.scrollable-area {
			position: relative;
			width: 100%;
			height: 100%;
			overflow-x: hidden;
			overflow-y: scroll;
			overflow-anchor: none;
		}

		.trimmed-column {
			width: 20px;
			display: flex;
		}

		.selectable-area {
			position: absolute;
			width: 100%;
			min-height: 100%;

			.selection-rectangle {
				position: absolute;
				background:
					linear-gradient(90deg, colors.$active-rectangle 66%, transparent 0) repeat-x,
					linear-gradient(90deg, colors.$active-rectangle 66%, transparent 0) repeat-x,
					linear-gradient(0deg, colors.$active-rectangle 66%, transparent 0) repeat-y,
					linear-gradient(0deg, colors.$active-rectangle 66%, transparent 0) repeat-y;
				background-size: 10px 2px, 10px 2px, 2px 10px, 2px 10px;
				background-position: 0 0, 0 100%, 0 0, 100% 0;
				animation: border-animate 800ms infinite linear;
			}

			@keyframes border-animate {
				100% {
					background-position: 10px 0, -10px 100%, 0 -10px, 100% 10px;
				}
			}

			&:has(.trash) {
				background-image: colors.$trash-background;
				background-color: transparent;
				background-attachment: fixed;
			}
		}
	}

	input[type="file"] {
		width: 0 !important;
		height: 0 !important;
		position: absolute;
		bottom: 0;
		padding: 0;
	}

	.progress-overlay {
		@include progress.progress-overlay;
	}

	ul.inode-list {
		margin: 0;

		> li {
			display: block;
			list-style: none;
			border: 1px solid transparent;
			position: relative;

			&:hover {
				filter: brightness(1.125);
			}

			&.selected {
				box-shadow: inset  0 0 0.5rem var(--accent);
				outline: 1px dotted var(--accent);
				background-color: rgb(from colors.$selected-row-color r g b / 50%);
			}

			&.disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			[aria-roledescription="draggable"]:focus-visible {
				outline: none;
			}

			.inode {
				&.drag-over {
					color: colors.$selected-row-color;
					background-color: var(--primary);
					outline: 1px solid var(--link-hover-color);
				}

				.inode-name {
					padding: 5px;
					border-radius: 3px;

					&:focus-visible {
						background-color: colors.$body-bg-color;
						outline: 1px solid var(--link-selected-fg);
						outline-offset: -1px;
						box-shadow: inset var(--link-selected-fg) 0 0 10px;
					}
				}
			}
		}
	}

	.tiles ul.inode-list, .mosaic ul.inode-list {
		display: flex;
		padding: 15px;
		flex-wrap: wrap;
		flex-direction: row;
		align-content: flex-start;
		justify-content: flex-start;

		> li {
			padding: 5px;

			.inode {
				box-sizing: border-box;

				div:has(> .figure-labels) {
					position: relative;
				}

				.figure-labels {
					position: absolute;
					line-height: 0;
					text-align: right;
					overflow: hidden;
				}

				figure, .figure {
					height: 100%;
					display: flex;
					flex-direction: column;
					flex-wrap: nowrap;
					justify-content: space-between;
					margin: 0;

					img {
						width: 100%;
						border-radius: 5px;

						&:not([src$=".svg"]) {
							box-shadow: colors.$border-color 0 0 5px;
						}
					}

					video {
						border-radius: 5px;
						box-shadow: colors.$border-color 0 0 5px;
					}

					figcaption {
						text-align: center;
						width: 180px;
						margin: 0 auto;
						word-break: break-all;
					}
				}

				.inode-name {
					margin-top: 2px;
				}
			}
		}
	}

	.tiles ul.inode-list li {
		margin-bottom: 5px;

		&:not(.status) {
			min-height: 248px;
			width: 192px;
			box-sizing: border-box;
			cursor: pointer;
			font-size: 15px;
			line-height: 18px;

			> .reordering {
				position: absolute;
				top: 0;
				right: -5px;
				bottom: 0;

				> div {
					height: 188px;
					width: 4px;
					margin: 2px;
					border-radius: 2px;
				}

				&.drag-over > div {
					background-color: var(--primary);
				}
			}

			.inode figure {
				> div:has(img[src$=".svg"]) {
					padding: 15px; // reduce the size of SVG images
				}

				.figure-labels {
					inset: 5px;

					span {
						width: 12px;
						height: 12px;
						display: inline-block;
						border-radius: 50%;
						margin-left: -4px;
					}
				}
			}
		}
	}

	.mosaic ul.inode-list li {
		margin-bottom: 8px;
		line-height: 10px;

		&:not(.status) {
			width: 70px;
			cursor: pointer;

			> .reordering {
				position: absolute;
				top: 0;
				right: -5px;
				bottom: 0;

				> div {
					height: 100%;
					width: 4px;
					margin: 2px;
					border-radius: 2px;
				}

				&.drag-over > div {
					background-color: var(--primary);
				}
			}

			.inode .figure-labels {
				inset: 2px;

				span {
					width: 8px;
					height: 8px;
					display: inline-block;
					border-radius: 50%;
					margin-left: -3px;
				}
			}
		}
	}

	.list ul.inode-list, .columns ul.inode-list {
		display: block;
		padding: 0;

		> li {
			width: 100%;
			box-sizing: border-box;
			padding: 5px;

			&:nth-child(even):not(.selected) {
				background-color: colors.$darkened-bg;
			}

			&:last-child {
				border-bottom: 1px solid colors.$border-color;
			}

			> .reordering {
				position: absolute;
				top: -3px;
				left: 0;
				right: 0;
				height: 5px;

				> div {
					height: 3px;
					margin: 2px;
					border-radius: 2px;
				}

				&.drag-over > div {
					background-color: var(--primary);
				}
			}


			.inode {
				display: grid;
				gap: 2px;
				align-items: center;

				div {
					&:has(img, video) {
						display: flex;
						justify-content: center;

						img, div:has(>video) {
							height: 60px;
							align-self: center;
						}
					}

					&:has(> .inode-name) {
						overflow: hidden;
						padding-right: 1rem;
					}
				}

				.figure-labels {
					display: inline-flex;
					width: 15px;
					height: 60px;
					overflow: hidden;
					flex-direction: column;
					align-items: end;
					padding-top: 4px;

					span {
						width: 10px;
						height: 10px;
						display: block;
						border-radius: 50%;
						margin-top: -3px;
					}

				}
			}
		}
	}

	.list ul.inode-list {
		> li {

			&.header {
				height: auto;
				font-weight: bold;
				border-bottom: 1px solid colors.$border-color;
			}

			.inode {
				grid-template-columns: 90px 1fr 1fr 1fr;
				@media (min-width: 992px) and (max-width: 1199.98px) {
					grid-template-columns: 90px 1fr 1fr 1fr 1fr 1fr;
				}
				@media (min-width: 1200px) {
					grid-template-columns: 90px 1fr 1fr 1fr 1fr 1fr 1fr;
				}

				div {
					&:nth-child(6) {
						display: none;
						@media (min-width: 1200px) {
							display: block;
						}
					}
					&:nth-child(7) {
						display: none;
						@media (min-width: 992px) {
							display: block;
						}
					}
				}
			}
		}
	}

	.columns ul.inode-list {
		margin-top: 0.25rem;

		>li:has(>div>div.parent) {
			border-top: colors.$follow-folder-border;
			border-left: colors.$follow-folder-border;
			border-bottom: colors.$follow-folder-border;
			border-top-left-radius: 5px;
			border-bottom-left-radius: 5px;
		}

		.inode {
			grid-template-columns: 90px 1fr;
			position: relative;
			box-sizing: border-box;

			&.parent::after {
				position: absolute;
				right: 0;
				content: " ";
				width: 32px;
				height: 32px;
				background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgb(192, 192, 192)"><path d="M13.1714 12.0007L8.22168 7.05093L9.63589 5.63672L15.9999 12.0007L9.63589 18.3646L8.22168 16.9504L13.1714 12.0007Z"></path></svg>');
				background-repeat: no-repeat;
			}
		}
	}

	.download-droppable, .discard-droppable {
		position: absolute;
		bottom: 0;
		width: 110px;
		height: 85px;
		overflow: hidden;

		&:not(.dragging) {
			visibility: hidden;
		}

		.quadrant {
			position: absolute;
			bottom: -75px;
			width: 200px;
			height: 150px;
			color: var(--button-fg);
			background-color: var(--button-bg);
			border: 3px solid var(--default-button-bg);
			border-radius: 50%;
			transform: scale(0);
			transition: transform 0.5s ease-in-out;

			svg {
				width: 40px;
				height: 40px;
				position: absolute;
				bottom: 80px;
			}
		}

		&.dragging .quadrant {
			transform: scale(1);
		}

		&.dragging.drag-over .quadrant {
			background-color: var(--default-button-bg);
			color: colors.$selected-row-color;
		}
	}

	.download-droppable {
		left: 0;

		.quadrant {
			left: -100px;

			svg {
				left: 120px;
			}
		}
	}

	.discard-droppable {
		right: 0;

		.quadrant {
			right: -100px;

			svg {
				right: 120px;
			}
		}
	}

	.drag-overlay {
		ul.inode-list {
			opacity: 0.7;
			border: 1px dashed var(--body-quiet-color);
			overflow: hidden;

			> li {
				cursor: grabbing;
			}
		}
	}

	.detail-editor {
		padding: 0 20px 40px;
		background-color: colors.$body-bg-color;
		margin-top: -15px;

		input[readonly] {
			border: none;
			padding-left: 0;
			padding-right: 0;
			&:focus-visible {
				outline: none;
			}
		}

		.form-row.field-labels {
			overflow: visible;  // allow the dropdown to overflow the container
		}
	}

	.file-details {
		width: 100%;

		h2 {
			padding-top: 1em;
			padding-bottom: 0.5em;
		}

		img.editable {
			width: 100%;
			max-height: 500px;
		}
		img:not(.editable) {
			height: 150px;
		}

		div.button-group {
			margin-top: 10px;
			margin-bottom: 10px;
			display: flex;
			flex-wrap: wrap;
			button, a {
				display: block;
				appearance: none;
				border: none;
				font-weight: 400;
				border-radius: 4px;
				padding: 5px 15px;
				line-height: 25px;
				color: var(--button-fg);
				background: var(--default-button-bg);
				margin-right: 10px;
				margin-bottom: 10px;
				cursor: pointer;
				&:hover {
					background: var(--default-button-hover-bg);
				}
				&[disabled] {
					opacity: 0.4;
					cursor: not-allowed;
				}

				svg {
					margin-right: 0.5rem;
					vertical-align: text-bottom;
					width: 20px;
				}
			}
			[role="combobox"] {
				font-weight: 400;
				border-radius: 4px;
				padding: 5px 15px;
				line-height: 25px;
				color: var(--button-fg);
				background: var(--default-button-bg);
				margin-right: 10px;
				margin-bottom: 10px;
				&[aria-expanded="false"] {
					cursor: pointer;
					&:hover {
						background: var(--default-button-hover-bg);
					}
				}
				&::after {
					margin-left: 10px;
					border-top-color: var(--button-fg);
				}
				[role="listbox"] {
					color: inherit;
					background-color: inherit;
					padding: 5px;
					> li {
						padding: 0 30px 0 10px;
						cursor: pointer;
						&:hover {
							background-color: var(--default-button-hover-bg);
						}
						&[aria-selected=true] {
							color: colors.$selected-row-color;
							background-color: inherit;

							&::after {
								content: "âœ“";
							}
						}
					}
				}
			}
		}
	}

	@include labels.labels;
	@include dropdown.dropdown;
}

@include meta.load-css('node_modules/react-image-crop/src/ReactCrop.scss');
